import streamlit as st
import pandas as pd
import plotly.graph_objects as go
from ui.components.elements import render_detailed_group_card

def show_marketing_page():
    st.caption("–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø—Ä–æ—Å–æ–º –∏ —Å—Ç–∏–º—É–ª—è—Ü–∏—è —Å–±—ã—Ç–∞ —á–µ—Ä–µ–∑ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏")

    # --- –ë–õ–û–ö 1: 4 –°–ú–´–°–õ–û–í–´–ï –ö–ê–†–¢–û–ß–ö–ò ---
    c1, c2, c3, c4 = st.columns(4)

    with c1:
        render_detailed_group_card("–†–µ–∫–ª–∞–º–Ω—ã–π —Ä—ã—á–∞–≥", "ROI 185%", "#10b981", "trending_up", [
            ("–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –≤—ã—Ä—É—á–∫–∏", "+840–∫ ‚ÇΩ"), ("–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏—è", "Feeto Care")
        ])
    with c2:
        render_detailed_group_card("–°–±—Ä–æ—Å –Ω–µ–ª–∏–∫–≤–∏–¥–∞", "312,000 ‚ÇΩ", "#f59e0b", "inventory_2", [
            ("–ó–∞–º–æ—Ä–æ–∂–µ–Ω–æ (60–¥+)", "12 SKU"), ("–¶–µ–ª—å", "–í—ã—Å–≤–æ–±–æ–¥–∏—Ç—å –∫—ç—à")
        ])
    with c3:
        render_detailed_group_card("–õ–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è", "145 —á–µ–ª.", "#6366f1", "group_add", [
            ("–ü—Ä–µ–¥–∑–∞–∫–∞–∑—ã", "210,000 ‚ÇΩ"), ("–°—Ç–∞—Ç—É—Å", "–ì–æ—Ç–æ–≤—ã –∫ –ø–æ–∫—É–ø–∫–µ")
        ])
    with c4:
        render_detailed_group_card("–≠—Ñ—Ñ–µ–∫—Ç –ù–∞–±–æ—Ä–æ–≤", "+22% —á–µ–∫", "#8b5cf6", "auto_awesome", [
            ("Up-sell –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª", "115–∫ ‚ÇΩ"), ("–°–≤—è–∑–æ–∫ —Å–æ–∑–¥–∞–Ω–æ", "8 –ø–∞—Ä")
        ])

    st.divider()

    # --- –ë–õ–û–ö 2: –ì–†–ê–§–ò–ö "–†–ï–ö–õ–ê–ú–ù–´–ô –†–´–ß–ê–ì" ---
    st.subheader("–ü—Ä–æ–≥–Ω–æ–∑: –û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π —Å–ø—Ä–æ—Å vs –†–µ–∫–ª–∞–º–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ")
    
    # –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
    skus = ["–ö—Ä–µ–º Red & Itchy", "–ú–∞—Å–ª–æ –≤–æ—Å—Å—Ç.", "Cell Booster", "–ö—Ä–µ–º —Ä—É–∫", "–ü–∞–∫–µ—Ç –∑–∏–ø"]
    organic_sales = [120, 85, 40, 200, 500]
    marketing_uplift = [180, 110, 95, 40, 0] # –î–æ–±–∞–≤–æ—á–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ –æ—Ç —Ä–µ–∫–ª–∞–º—ã

    fig = go.Figure()
    # –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–¥–∞–∂–∏
    fig.add_trace(go.Bar(
        x=skus, y=organic_sales, 
        name='–û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π —Å–ø—Ä–æ—Å',
        marker_color='#4f46e5'
    ))
    # –ü—Ä–∏—Ä–æ—Å—Ç –æ—Ç –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞
    fig.add_trace(go.Bar(
        x=skus, y=marketing_uplift, 
        name='–ü—Ä–æ–≥–Ω–æ–∑ –æ—Ç —Ä–µ–∫–ª–∞–º—ã (ROI 150%+)',
        marker_color='#10b981'
    ))

    fig.update_layout(
        barmode='stack', 
        template="plotly_white",
        height=400,
        legend=dict(orientation="h", yanchor="bottom", y=1.02, xanchor="right", x=1),
        margin=dict(t=0, b=0, l=0, r=0)
    )
    
    st.plotly_chart(fig, use_container_width=True)
    
    st.info("üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ó–∞–ø—É—Å–∫ —Ä–µ–∫–ª–∞–º—ã –¥–ª—è 'Cell Booster' –Ω–∞–∏–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω ‚Äî —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ–¥–∞–∂–∏ –Ω–∏–∑–∫–∏–µ, –Ω–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª (ROI) –ø—Ä–µ–≤—ã—à–∞–µ—Ç 210%.")

    # --- –ë–õ–û–ö 3: –¢–ê–ë–õ–ò–¶–ê –¶–ï–õ–ï–í–´–• –ö–ê–ú–ü–ê–ù–ò–ô ---
    st.markdown("### –¶–µ–ª–µ–≤—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞")
    
    promo_df = pd.DataFrame({
        "–¢–æ–≤–∞—Ä / –ö–∞—Ç–µ–≥–æ—Ä–∏—è": ["Cell Booster", "–ö—Ä–µ–º Red & Itchy", "–ü–∞–∫–µ—Ç –∑–∏–ø-–ª–æ–∫", "–ú–∞—Å–ª–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ"],
        "–¶–µ–ª—å –∫–∞–º–ø–∞–Ω–∏–∏": ["–†–æ—Å—Ç –¥–æ–ª–∏ —Ä—ã–Ω–∫–∞", "–£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏", "–õ–∏–∫–≤–∏–¥–∞—Ü–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤", "–ö—Ä–æ—Å—Å-—Å–µ–π–ª"],
        "–ü—Ä–æ–≥–Ω–æ–∑ ROI": ["215%", "165%", "90%", "145%"],
        "–°—Ç–∞—Ç—É—Å": ["–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è", "–û–ø—Ç–∏–º–∞–ª—å–Ω–æ", "–ù–∏–∑–∫–∞—è –º–∞—Ä–∂–∞", "–°—Ä–µ–¥–Ω–µ"]
    })

    def color_status(val):
        color = '#d1fae5' if val == "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è" else '#fee2e2' if val == "–ù–∏–∑–∫–∞—è –º–∞—Ä–∂–∞" else ''
        return f'background-color: {color}'

    st.dataframe(promo_df.style.applymap(color_status, subset=['–°—Ç–∞—Ç—É—Å']), use_container_width=True, hide_index=True)